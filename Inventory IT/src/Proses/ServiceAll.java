package Proses;

import KomponenGUI.FDateF;
import LSubProces.MultiInsert;
import javax.swing.JOptionPane;
import java.awt.event.KeyEvent;
import java.util.Calendar;
import java.util.Date;

/**
 *
 * @author Martono
 */
public class ServiceAll extends javax.swing.JFrame {

    Object[] idService;

    /**
     * Creates new form MasterPemasok
     */
    public ServiceAll(Object[] id) {
        initComponents();
        setLocationRelativeTo(null);
        setDefaultCloseOperation(DISPOSE_ON_CLOSE);
        idService = new Object[id.length];
        idService = id;
        setTitle("Service");
        setVisible(true);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        JLTanggalService = new KomponenGUI.JlableF();
        JLTanggalService2 = new KomponenGUI.JlableF();
        JDTanggalService = new KomponenGUI.JdateCF();
        JLTanggalServiceSelanjutnya = new KomponenGUI.JlableF();
        JLTanggalServiceSelanjutnya2 = new KomponenGUI.JlableF();
        JNTanggalServiceSelanjutnya = new KomponenGUI.JNumberOnly();
        JLTanggalServiceSelanjutnya3 = new KomponenGUI.JlableF();
        JDTanggalServiceSelanjutnya = new KomponenGUI.JdateCF();
        JLKeterangan = new KomponenGUI.JlableF();
        JLKeterangan2 = new KomponenGUI.JlableF();
        JSPKeterangan = new javax.swing.JScrollPane();
        JTKeterangan = new KomponenGUI.JTextAreaF();
        JBKembali = new KomponenGUI.JbuttonF();
        JBService = new KomponenGUI.JbuttonF();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setResizable(false);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosed(java.awt.event.WindowEvent evt) {
                formWindowClosed(evt);
            }
        });

        JLTanggalService.setText("Tanggal Service");

        JLTanggalService2.setText(":");

        JDTanggalService.setDate(new Date());
        JDTanggalService.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                JDTanggalServiceKeyReleased(evt);
            }
        });

        JLTanggalServiceSelanjutnya.setText("Tanggal Service Selanjutnya");

        JLTanggalServiceSelanjutnya2.setText(":");

        JNTanggalServiceSelanjutnya.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        JNTanggalServiceSelanjutnya.setmaxtText(5);
        JNTanggalServiceSelanjutnya.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                JNTanggalServiceSelanjutnyaFocusLost(evt);
            }
        });
        JNTanggalServiceSelanjutnya.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                JNTanggalServiceSelanjutnyaKeyReleased(evt);
            }
        });

        JLTanggalServiceSelanjutnya3.setText("Hari =");

        JDTanggalServiceSelanjutnya.setDate(new Date());

        JLKeterangan.setText("Keterangan");

        JLKeterangan2.setText(":");

        JTKeterangan.setColumns(20);
        JTKeterangan.setLineWrap(true);
        JTKeterangan.setRows(5);
        JTKeterangan.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                JTKeteranganKeyPressed(evt);
            }
        });
        JSPKeterangan.setViewportView(JTKeterangan);

        JBKembali.setText("Kembali");
        JBKembali.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                JBKembaliActionPerformed(evt);
            }
        });

        JBService.setText("Service");
        JBService.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                JBServiceActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(JBKembali, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(JBService, javax.swing.GroupLayout.PREFERRED_SIZE, 110, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(JLKeterangan, javax.swing.GroupLayout.PREFERRED_SIZE, 222, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(JLKeterangan2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(JSPKeterangan, javax.swing.GroupLayout.DEFAULT_SIZE, 342, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(JLTanggalService, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(JLTanggalServiceSelanjutnya, javax.swing.GroupLayout.DEFAULT_SIZE, 222, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(JLTanggalServiceSelanjutnya2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(JNTanggalServiceSelanjutnya, javax.swing.GroupLayout.PREFERRED_SIZE, 65, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(JLTanggalServiceSelanjutnya3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(JDTanggalServiceSelanjutnya, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(JLTanggalService2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(JDTanggalService, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))))
                .addGap(10, 10, 10))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(JLTanggalService, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(JLTanggalService2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(JDTanggalService, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(JLTanggalServiceSelanjutnya, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(JLTanggalServiceSelanjutnya2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(JNTanggalServiceSelanjutnya, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(JLTanggalServiceSelanjutnya3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(JDTanggalServiceSelanjutnya, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(JLKeterangan, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(JLKeterangan2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addComponent(JSPKeterangan, javax.swing.GroupLayout.DEFAULT_SIZE, 150, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(JBService, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(JBKembali, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void JBKembaliActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_JBKembaliActionPerformed
        GlobalVar.Var.serviceAll.dispose();
    }//GEN-LAST:event_JBKembaliActionPerformed

    private void JBServiceActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_JBServiceActionPerformed
        service();
    }//GEN-LAST:event_JBServiceActionPerformed

    private void JTKeteranganKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_JTKeteranganKeyPressed
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            service();
        }
    }//GEN-LAST:event_JTKeteranganKeyPressed

    private void JDTanggalServiceKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_JDTanggalServiceKeyReleased
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            JNTanggalServiceSelanjutnya.requestFocus();
        }
    }//GEN-LAST:event_JDTanggalServiceKeyReleased

    private void JNTanggalServiceSelanjutnyaKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_JNTanggalServiceSelanjutnyaKeyReleased
        if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
            JTKeterangan.requestFocus();
        }
    }//GEN-LAST:event_JNTanggalServiceSelanjutnyaKeyReleased

    private void JNTanggalServiceSelanjutnyaFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_JNTanggalServiceSelanjutnyaFocusLost
        nextService(Integer.valueOf(JNTanggalServiceSelanjutnya.getText()));
    }//GEN-LAST:event_JNTanggalServiceSelanjutnyaFocusLost

    private void formWindowClosed(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosed
        GlobalVar.Var.serviceAll = null;
    }//GEN-LAST:event_formWindowClosed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(ServiceAll.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(ServiceAll.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(ServiceAll.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(ServiceAll.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
            }
        });
    }

    boolean checkInput() {
        if (JDTanggalService.getDate() == null) {
            JOptionPane.showMessageDialog(this, "Tanggal Service Tidak Boleh Kosong", "Information", JOptionPane.INFORMATION_MESSAGE);
            JDTanggalService.requestFocus();
            return false;
        } else if (JDTanggalServiceSelanjutnya.getDate() == null) {
            JOptionPane.showMessageDialog(this, "Tanggal Service Selanjutnya Tidak Boleh Kosong", "Information", JOptionPane.INFORMATION_MESSAGE);
            JDTanggalServiceSelanjutnya.requestFocus();
            return false;
        } else if (JDTanggalServiceSelanjutnya.getDate().compareTo(JDTanggalService.getDate()) < 0) {
            JOptionPane.showMessageDialog(this, "Tanggal Service Selanjutnya Tidak Boleh Lebih Kecil Dari Tanggal Service Sekarang", "Information", JOptionPane.INFORMATION_MESSAGE);
            JDTanggalServiceSelanjutnya.requestFocus();
            return false;
        } else {
            return true;
        }
    }

    void nextService(int hari) {
        Calendar calendar = Calendar.getInstance();
        calendar.setTime(JDTanggalService.getDate());
        for (int index = 0; index < hari; index++) {
            calendar.add(Calendar.DATE, 1);
        }
        JDTanggalServiceSelanjutnya.setDate(calendar.getTime());
    }

    void service() {
        if (checkInput()) {
            MultiInsert multiInsert = new MultiInsert();
            boolean simpan = multiInsert.OpenConnection();
            if (simpan) {
                simpan = multiInsert.setautocomit(false);
                for (int i = 0; i < idService.length; i++) {
                    if (simpan) {
                        simpan = multiInsert.Excute("INSERT INTO `tbservice`(`IdJenisService`, `IdBarangService`, `TanggalService`, `TanggalServiceSelanjutnya`, `Keterangan`) VALUES ((SELECT `IdJenisService` FROM `tbservice` AS A WHERE A.`IdService`='" + idService[i] + "'), (SELECT `IdBarangService` FROM `tbservice` AS B WHERE B.`IdService`='" + idService[i] + "'), '" + FDateF.datetostr(JDTanggalService.getDate(), "yyyy-MM-dd") + "', '" + FDateF.datetostr(JDTanggalServiceSelanjutnya.getDate(), "yyyy-MM-dd") + "', '" + JTKeterangan.getText() + "')", this);
                    }
                }
            }
            if (simpan == true) {
                multiInsert.Commit();
                multiInsert.closecon();
                JOptionPane.showMessageDialog(this, "Berhasil Service", "Information", JOptionPane.INFORMATION_MESSAGE);
                GlobalVar.Var.serviceAll.dispose();
                GlobalVar.Var.listService.load();
            } else {
                multiInsert.rollback();
                multiInsert.closecon();
                JOptionPane.showMessageDialog(this, "Gagal Service", "Information", JOptionPane.INFORMATION_MESSAGE);
            }
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private KomponenGUI.JbuttonF JBKembali;
    private KomponenGUI.JbuttonF JBService;
    private KomponenGUI.JdateCF JDTanggalService;
    private KomponenGUI.JdateCF JDTanggalServiceSelanjutnya;
    private KomponenGUI.JlableF JLKeterangan;
    private KomponenGUI.JlableF JLKeterangan2;
    private KomponenGUI.JlableF JLTanggalService;
    private KomponenGUI.JlableF JLTanggalService2;
    private KomponenGUI.JlableF JLTanggalServiceSelanjutnya;
    private KomponenGUI.JlableF JLTanggalServiceSelanjutnya2;
    private KomponenGUI.JlableF JLTanggalServiceSelanjutnya3;
    private KomponenGUI.JNumberOnly JNTanggalServiceSelanjutnya;
    private javax.swing.JScrollPane JSPKeterangan;
    private KomponenGUI.JTextAreaF JTKeterangan;
    // End of variables declaration//GEN-END:variables
}
